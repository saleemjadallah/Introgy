
name: Xcode Cloud Build

# This workflow configuration helps Xcode Cloud find the correct project
# Updated to use the correct scheme name: App

settings:
  xcode:
    project: ios/App/App.xcodeproj
    workspace: ios/App/App.xcworkspace
    scheme: App

# Define the build steps
steps:
  - name: Build and Archive
    build:
      project: ios/App/App.xcodeproj
      workspace: ios/App/App.xcworkspace
      scheme: App
      configuration: Release
      destination: 'generic/platform=iOS'
      sdk: 'iphoneos'
      archive:
        path: app.xcarchive
        exportOptions:
          method: app-store
          
  - name: Upload to TestFlight
    beta_app_review_info:
      contact_email: test@example.com
      contact_first_name: Test
      contact_last_name: User
      contact_phone: '+11234567890'
      demo_account_name: test@example.com
      demo_account_password: test123
      notes: "This build is for testing purposes. Contact test@example.com for any issues."
      
# Pre-build script to ensure permissions are correct and install dependencies
pre_build_script: ./xcode_cloud_pre_build.sh
