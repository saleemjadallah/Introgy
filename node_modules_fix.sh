#!/bin/bash

# Script to add CapacitorCordova header files directly to node_modules
# This ensures Xcode Cloud can find them at /Volumes/workspace/repository/node_modules

echo "Setting up CapacitorCordova header files in node_modules..."

# Create directories
mkdir -p node_modules/@capacitor/ios/CapacitorCordova/CapacitorCordova/Classes/Public

# Copy the standalone header to each required header file in node_modules
for header in "CDVViewController.h" "CDVInvokedUrlCommand.h" "NSDictionary+CordovaPreferences.h" "CDVPlugin.h" "CDVPluginResult.h" "CDVCommandDelegate.h" "CDVConfigParser.h" "CDVWebViewProcessPoolFactory.h"; do
  cp cordova_header_standalone.h "node_modules/@capacitor/ios/CapacitorCordova/CapacitorCordova/Classes/Public/$header"
  echo "Created $header"
done

# Create the main CapacitorCordova.h file
cp cordova_header_standalone.h node_modules/@capacitor/ios/CapacitorCordova/CapacitorCordova/CapacitorCordova.h
echo "Created CapacitorCordova.h"

# Create basic implementation files to satisfy compilation
mkdir -p node_modules/@capacitor/ios/CapacitorCordova/CapacitorCordova/Classes/Public/Implementations

# Copy the stub implementation file
cp cordova_stub.m node_modules/@capacitor/ios/CapacitorCordova/CapacitorCordova/Classes/Public/Implementations/cordova_stubs.m
echo "Added implementation stubs"

echo "Node modules setup complete. All required header files have been placed in node_modules/@capacitor/ios/CapacitorCordova/"
echo "These files will be available at /Volumes/workspace/repository/node_modules/@capacitor/ios/CapacitorCordova/ in Xcode Cloud"